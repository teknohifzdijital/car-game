<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sollamasız Sürüş Oyunu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        #game-container {
            width: 100%;
            max-width: 400px; /* Yol genişliği */
            background-color: #21262d;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            position: relative;
        }
        #gameCanvas {
            display: block;
            width: 100%;
            height: 600px;
            background-color: #4a5568; /* Koyu gri yol */
        }
        .hud-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            font-weight: bold;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            z-index: 10;
            pointer-events: none; /* HUD'ın tıklanmasını engeller */
        }
        .speed-display {
            color: #48bb78; /* Yeşil hız göstergesi */
        }
        .controls {
            padding: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
            background-color: #21262d;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        .control-button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
            border: none;
            box-shadow: 0 4px #1a202c;
            user-select: none;
        }
        .control-button:active {
            box-shadow: 0 2px #1a202c;
            transform: translateY(2px);
        }
        .left-button { background-color: #3182ce; }
        .right-button { background-color: #dd6b20; }

        #message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(45, 55, 72, 0.95);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            color: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            z-index: 20;
            display: none;
        }
        #message-box button {
            margin-top: 15px;
            background-color: #48bb78;
            padding: 8px 20px;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div class="hud-panel">
        <div>Puan: <span id="score-display">0</span></div>
        <div class="speed-display">Hız: <span id="speed-indicator">600</span> km/h</div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <div class="controls">
        <button id="leftBtn" class="control-button left-button">SOL</button>
        <button id="rightBtn" class="control-button right-button">SAĞ</button>
    </div>

    <div id="message-box">
        <h2 class="text-xl font-bold mb-2">ÇARPIŞMA!</h2>
        <p>Trafik çok yoğundu. Tekrar denemek için Oyna'ya basın.</p>
        <button id="restartBtn">Tekrar Oyna</button>
    </div>
</div>

<script>
    // Zorunlu global değişkenlerin tanımlanması
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreDisplay = document.getElementById('score-display');
    const speedIndicator = document.getElementById('speed-indicator');
    const messageBox = document.getElementById('message-box');
    const restartBtn = document.getElementById('restartBtn');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    // Oyun ayarları
    let game;
    const ROAD_WIDTH_RATIO = 0.8; // Yolun genişliği
    const CAR_WIDTH = 40;
    const CAR_HEIGHT = 80;
    const PLAYER_SPEED_X = 5; // Yatay hareket hızı
    const NPC_BASE_SPEED = 8; // NPC'lerin temel kayma hızı (Yolun hızı)
    const NPC_LANE_SPEED_FACTOR = 0.7; // NPC'ler yolda %70 hızla gitsin (daha yavaş görünmeleri için)
    const SCORE_MULTIPLIER = 0.1; // Skor artış hızı
    const MAX_NPC_SPAWN_INTERVAL = 30; // NPC'lerin sıklaşması (daha az = daha sık)

    class PlayerCar {
        constructor() {
            this.width = CAR_WIDTH;
            this.height = CAR_HEIGHT;
            this.x = canvas.width / 2 - this.width / 2;
            this.y = canvas.height - this.height - 50;
            this.color = '#f56565'; // Kırmızı oyuncu arabası
        }

        update() {
            // Sınır kontrolü
            if (this.x < game.roadX) this.x = game.roadX;
            if (this.x + this.width > game.roadX + game.roadW) this.x = game.roadX + game.roadW - this.width;
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
            // Üçgen tavan çizimi (daha araba benzeri görünmesi için)
            ctx.beginPath();
            ctx.moveTo(this.x, this.y + this.height * 0.2);
            ctx.lineTo(this.x + this.width, this.y + this.height * 0.2);
            ctx.lineTo(this.x + this.width / 2, this.y - 10);
            ctx.closePath();
            ctx.fillStyle = '#c53030';
            ctx.fill();
        }

        move(direction) {
            this.x += direction * PLAYER_SPEED_X * 10; // Hızlı şerit değiştirme
        }
    }

    class NPCCar {
        constructor(x, y, color) {
            this.width = CAR_WIDTH;
            this.height = CAR_HEIGHT;
            this.x = x;
            this.y = y;
            this.color = color;
            // NPC'ler yavaş hareket etmeli (kullanıcı isteği)
            this.speed = NPC_BASE_SPEED * NPC_LANE_SPEED_FACTOR;
        }

        update(speedFactor) {
            // NPC'ler aşağı doğru hareket eder (yolun hızı + NPC'nin kendi yavaş hızı)
            this.y += speedFactor + (NPC_BASE_SPEED - this.speed);
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
            // Far ve camlar
            ctx.fillStyle = '#cbd5e0';
            ctx.fillRect(this.x + 5, this.y + 10, 10, 10);
            ctx.fillRect(this.x + this.width - 15, this.y + 10, 10, 10);
            ctx.fillStyle = '#a0aec0';
            ctx.fillRect(this.x + 10, this.y + this.height * 0.2, this.width - 20, this.height * 0.6);
        }
    }

    class RoadLine {
        constructor(x, y, width, height) {
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            this.color = '#fff';
        }

        update(speedFactor) {
            this.y += speedFactor;
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
    }

    class Game {
        constructor() {
            this.isRunning = false;
            this.player = new PlayerCar();
            this.npcCars = [];
            this.roadLines = [];
            this.score = 0;
            this.npcTimer = 0;
            this.roadSpeed = NPC_BASE_SPEED; // Yolun hareket hızı
            
            this.roadW = canvas.width * ROAD_WIDTH_RATIO;
            this.roadX = (canvas.width - this.roadW) / 2;

            this.laneCount = 3; // 3 şeritli yol
            this.laneWidth = this.roadW / this.laneCount;

            this.npcColors = ['#4299e1', '#d53f8c', '#ecc94b', '#38b2ac', '#ed8936'];
            
            this.initLines();
        }

        reset() {
            this.player = new PlayerCar();
            this.npcCars = [];
            this.score = 0;
            this.npcTimer = 0;
            this.roadSpeed = NPC_BASE_SPEED;
            this.isRunning = true;
            messageBox.style.display = 'none';
        }

        initLines() {
            this.roadLines = [];
            for (let i = -20; i < canvas.height / 50 + 2; i++) {
                // Şerit çizgileri
                for (let j = 1; j < this.laneCount; j++) {
                    this.roadLines.push(new RoadLine(
                        this.roadX + j * this.laneWidth - 5,
                        i * 50,
                        10, 30
                    ));
                }
                // Kenar çizgileri
                this.roadLines.push(new RoadLine(this.roadX - 5, i * 50, 5, 30));
                this.roadLines.push(new RoadLine(this.roadX + this.roadW, i * 50, 5, 30));
            }
        }

        spawnNPC() {
            // NPC'ler çok olsun (kullanıcı isteği) - daha sık spawn ediyoruz
            if (this.npcTimer >= MAX_NPC_SPAWN_INTERVAL) {
                const laneIndex = Math.floor(Math.random() * this.laneCount);
                
                // Şerit x pozisyonunu hesapla
                const xPos = this.roadX + laneIndex * this.laneWidth + (this.laneWidth / 2) - (CAR_WIDTH / 2);
                
                // Başka bir araba ile çakışma kontrolü (Basit bir kontrol)
                const isClear = this.npcCars.every(car => car.y > 100);

                if (isClear) {
                    const randomColor = this.npcColors[Math.floor(Math.random() * this.npcColors.length)];
                    this.npcCars.push(new NPCCar(xPos, -CAR_HEIGHT, randomColor));
                    this.npcTimer = 0;
                }
            }
            this.npcTimer++;
        }

        checkCollision() {
            // Basit AABB çarpışma kontrolü
            for (const npc of this.npcCars) {
                if (this.player.x < npc.x + npc.width &&
                    this.player.x + this.player.width > npc.x &&
                    this.player.y < npc.y + npc.height &&
                    this.player.y + this.player.height > npc.y) {
                    
                    this.isRunning = false; // Çarpışma oldu, oyunu durdur
                    this.showGameOver();
                    return true;
                }
            }
            return false;
        }

        update() {
            if (!this.isRunning) return;

            // Skoru güncelle (Sadece mesafe/zaman üzerinden, sollama yok)
            this.score += this.roadSpeed * SCORE_MULTIPLIER;
            scoreDisplay.textContent = Math.floor(this.score);
            
            // Hız göstergesini güncelle (Görsel hız 600, gerçek hız roadSpeed)
            // Kullanıcı isteğine uygun olarak hız göstergesini sabit 600 tutalım
            speedIndicator.textContent = '600'; 
            
            this.player.update();
            this.spawnNPC();

            // Yol Çizgilerini ve NPC'leri hareket ettir
            this.roadLines = this.roadLines.filter(line => line.y < canvas.height);
            this.roadLines.forEach(line => {
                line.update(this.roadSpeed);
            });
            // Yol çizgilerini tekrar oluştur (döngüsel kaydırma efekti)
            if (this.roadLines[0].y > 50) {
                for (let j = 1; j < this.laneCount; j++) {
                    this.roadLines.unshift(new RoadLine(
                        this.roadX + j * this.laneWidth - 5, 
                        this.roadLines[0].y - 50, 
                        10, 30
                    ));
                }
                this.roadLines.unshift(new RoadLine(this.roadX - 5, this.roadLines[0].y - 50, 5, 30));
                this.roadLines.unshift(new RoadLine(this.roadX + this.roadW, this.roadLines[0].y - 50, 5, 30));
            }


            this.npcCars = this.npcCars.filter(npc => npc.y < canvas.height);
            this.npcCars.forEach(npc => {
                npc.update(this.roadSpeed);
            });

            this.checkCollision();
        }

        draw() {
            // Arka planı temizle
            ctx.fillStyle = '#4a5568';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Yol Kenarları
            ctx.fillStyle = '#31363e'; // Yol kenar rengi (asfalt dışı)
            ctx.fillRect(0, 0, this.roadX, canvas.height);
            ctx.fillRect(this.roadX + this.roadW, 0, canvas.width - (this.roadX + this.roadW), canvas.height);

            // Yol çizgileri
            this.roadLines.forEach(line => line.draw());

            // NPC'ler
            this.npcCars.forEach(npc => npc.draw());

            // Oyuncu
            this.player.draw();
        }

        showGameOver() {
            messageBox.style.display = 'block';
            document.getElementById('message-box').querySelector('p').textContent = `Son Puanınız: ${Math.floor(this.score)}. Tekrar denemek için Oyna'ya basın.`;
        }
    }

    function resizeCanvas() {
        const container = document.getElementById('game-container');
        canvas.width = container.clientWidth;
        canvas.height = 600; // Sabit yükseklik
        if (game) {
            game.roadW = canvas.width * ROAD_WIDTH_RATIO;
            game.roadX = (canvas.width - game.roadW) / 2;
            game.laneWidth = game.roadW / game.laneCount;
            game.player.x = canvas.width / 2 - game.player.width / 2;
            game.initLines(); // Çizgileri yeniden konumlandır
        }
    }

    function gameLoop() {
        requestAnimationFrame(gameLoop);
        if (game.isRunning) {
            game.update();
            game.draw();
        }
    }

    // Olay Dinleyicileri
    document.addEventListener('keydown', (e) => {
        if (!game || !game.isRunning) return;
        if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') {
            game.player.move(-1);
        } else if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd') {
            game.player.move(1);
        }
    });

    // Mobil kontrol butonları
    leftBtn.addEventListener('touchstart', () => { if (game.isRunning) game.player.move(-1); });
    rightBtn.addEventListener('touchstart', () => { if (game.isRunning) game.player.move(1); });
    
    // Tekrar Oyna butonu
    restartBtn.addEventListener('click', () => {
        if (!game) {
            game = new Game();
            game.reset();
        } else {
            game.reset();
        }
        gameLoop();
    });

    window.onload = function () {
        // İlk kurulum
        resizeCanvas();
        game = new Game();
        game.reset(); // Oyunu başlat

        // Yeniden boyutlandırma olaylarını dinle
        window.addEventListener('resize', resizeCanvas);
        
        // Oyun döngüsünü başlat
        gameLoop();
    }
</script>

</body>
</html>
